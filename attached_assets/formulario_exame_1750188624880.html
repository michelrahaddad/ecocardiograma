<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Novo Exame - Sistema de Ecocardiograma</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark">
        <div class="container">
            <a class="navbar-brand" href="{{ url_for('index') }}">
                <span class="brand-text">Grupo Vidah</span> - Sistema de Ecocardiograma
            </a>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ml-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="{{ url_for('index') }}">Início</a>
                    </li>
                    <li class="nav-item active">
                        <a class="nav-link" href="{{ url_for('novo_exame') }}">Novo Exame</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container mt-4">
        <div class="card">
            <div class="card-header">
                <h2>Novo Exame de Ecocardiograma</h2>
            </div>
            <div class="card-body">
                <form id="exameForm" method="POST" action="{{ url_for('novo_exame') }}">
                    <div class="alert alert-danger d-none" id="form-error-message">
                        Por favor, corrija os erros no formulário antes de continuar.
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="nome_paciente">Nome do Paciente</label>
                                <input type="text" class="form-control" id="nome_paciente" name="nome_paciente">
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="form-group">
                                <label for="data_nascimento">Data de Nascimento</label>
                                <input type="text" class="form-control date-mask" id="data_nascimento" name="data_nascimento" placeholder="DD/MM/AAAA">
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="form-group">
                                <label for="idade">Idade</label>
                                <input type="number" class="form-control" id="idade" name="idade">
                            </div>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-3">
                            <div class="form-group">
                                <label for="sexo">Sexo</label>
                                <select class="form-control" id="sexo" name="sexo">
                                    <option value="">Selecione</option>
                                    <option value="Masculino">Masculino</option>
                                    <option value="Feminino">Feminino</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="form-group">
                                <label for="data_exame">Data do Exame</label>
                                <input type="text" class="form-control date-mask" id="data_exame" name="data_exame" placeholder="DD/MM/AAAA">
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="tipo_atendimento">Tipo de Atendimento</label>
                                <select class="form-control" id="tipo_atendimento" name="tipo_atendimento">
                                    <option value="">Selecione</option>
                                    <option value="Ambulatorial">Ambulatorial</option>
                                    <option value="Internado">Internado</option>
                                    <option value="Emergência">Emergência</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="medico_usuario">Médico Responsável</label>
                                <input type="text" class="form-control" id="medico_usuario" name="medico_usuario" value="Michel Raineri Haddad CRM:183299">
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="medico_solicitante">Médico Solicitante</label>
                                <input type="text" class="form-control" id="medico_solicitante" name="medico_solicitante">
                            </div>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-12">
                            <div class="form-group">
                                <label for="indicacao">Indicação</label>
                                <textarea class="form-control" id="indicacao" name="indicacao" rows="3"></textarea>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group text-center mt-4">
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-save"></i> Salvar e Continuar
                        </button>
                        <a href="{{ url_for('index') }}" class="btn btn-secondary">
                            <i class="fas fa-times"></i> Cancelar
                        </a>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <footer class="mt-5 py-3 text-center text-muted">
        <div class="container">
            <p>&copy; 2025 Grupo Vidah - Sistema de Ecocardiograma</p>
        </div>
    </footer>

    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.mask/1.14.16/jquery.mask.min.js"></script>
    <script src="{{ url_for('static', filename='js/medico_auto_preenchimento.js') }}"></script>
    <script>
        $(document).ready(function() {
            // Adicionar máscara para campos de data
            $('.date-mask').mask('00/00/0000');
            
            // Calcular idade automaticamente a partir da data de nascimento
            $('#data_nascimento').on('change', function() {
                const dataNasc = $(this).val();
                if (dataNasc) {
                    const partes = dataNasc.split('/');
                    if (partes.length === 3) {
                        const dataNascimento = new Date(partes[2], partes[1] - 1, partes[0]);
                        const hoje = new Date();
                        let idade = hoje.getFullYear() - dataNascimento.getFullYear();
                        const m = hoje.getMonth() - dataNascimento.getMonth();
                        if (m < 0 || (m === 0 && hoje.getDate() < dataNascimento.getDate())) {
                            idade--;
                        }
                        $('#idade').val(idade);
                    }
                }
            });
            
            // Preencher data do exame com a data atual
            const hoje = new Date();
            const dia = String(hoje.getDate()).padStart(2, '0');
            const mes = String(hoje.getMonth() + 1).padStart(2, '0');
            const ano = hoje.getFullYear();
            $('#data_exame').val(`${dia}/${mes}/${ano}`);
        });
    </script>
</body>
</html>
